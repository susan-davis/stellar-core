%% dgdebug -q damage-tests.dg damage.dg schema.dg sectored-grid.dg \
%%            unit.dg stdlib.dg

(list of tests [
      #shields-hold-from-ahead-50
      #shields-penetrated-from-ahead-101
      #shields-hold-from-port-50
      #shields-penetrated-from-port-101
	  #energy-depleted-from-port-550
	  #energy-depleted-from-ahead-600
      ])

%% ----------------------------------------------------------------------

#test-ship
(ship *)
(* initial state is
 [344 454 315 400 304 414 #cygnus-class 932 4 500 [100 100 100 100] 10 90 700])

#cygnus-class
(name *)	Cygnus
(type *)	scout ship
(* state is
 [0 0 180 300 500 963 #cygnus-class 1000 4 500 [100 100 100 100] 10])

#attack-class
(name *)	Attack
(type *)	attack ship
(* state is
 [0 0 90 100 200 751 #attack-class 500 2 250 [100 50 50 50] 0])

#closest-target
(ship *)
(* initial state is
     [355 445 225 200 0 0 #attack-class 500 2 250 [100 50 50 50] 0 225 200])

#near-target
(ship *)
(* initial state is
     [314 424 45 300 0 0 #attack-class 500 2 250 [100 50 50 50] 0 45 310])

%% ----------------------------------------------------------------------

(reset $Ship)	($Ship initial state is $State)
	   			(now) ($Ship state is $State)

(set up $)		(exhaust) { *(ship $Ship) (reset $Ship) }

%% ----------------------------------------------------------------------

(assert $Ship has $Shields and $Energy)
	($Ship shields $Shields)
	($Ship energy $Energy)

(show $Ship state)
	($Ship state is $State)
	$State

(test #shields-hold-from-ahead-50)
      (hit #closest-target from #north with 50)
      (assert #closest-target has 200 and 500)

(test #shields-penetrated-from-ahead-101)
      (hit #closest-target from #north with 101)
      (assert #closest-target has 150 and 499)

(test #shields-hold-from-port-50)
      (hit #closest-target from #west with 50)
      (assert #closest-target has 200 and 500)

(test #shields-penetrated-from-port-101)
      (hit #closest-target from #west with 101)
      (assert #closest-target has 200 and 449)

(test #energy-depleted-from-port-550)
	  (hit #closest-target from #west with 550)
	  (assert #closest-target has 200 and 0)

(test #energy-depleted-from-ahead-600)
	  (hit #closest-target from #north with 600)
	  (assert #closest-target has 150 and 0)

(test #penetrating-shields-damages-system)
	  (hit #closest-target from #north with 150)
	  (assert #closest-target has 150 and 450)
	  %% and now check for a damaged system
