%% dgdebug -q maneuver-tests.dg maneuvering.dg sectored-grid.dg \
%%            testrunner.dg stdlib.dg

(list of tests [
	#turn-ship
	#turn-ship-to-starboard
	#turn-ship-to-port
	#turn-ship-about
	#turn-ship-to-starboard-too-hard
	#turn-ship-to-port-too-hard
	#accelerate
	#accelerate-too-fast
	#accelerate-way-too-fast
	#decelerate
	#should-move-400
	#should-move-141
	#energy-for-warp-4
	#energy-for-warp-8
	#can-move-16000
	#can-move-1000
	#move-toward-dest
	])

%% ----------------------------------------------------------------------

#test-ship
(ship *)
(* initial state is
 [344 454 315 400 304 414 #cygnus-class 932 4 500 [100 100 100 100] 10 90 700])

#cygnus-class
(name *)	Cygnus
(type *)	scout ship
(* state is
 [0 0 180 300 500 2963 #cygnus-class 1000 4 500 [100 100 100 100] 10])

#sun
(grid object *)
(* state is [578 578])

#planet
(grid object *)
(* state is [575 576])

#other-planet
(grid object *)
(* state is [577 572])

#closest-target
(ship *)
(* initial state is
     [355 445 225 200 0 0 #attack-class 500 2 250 [100 50 50 50] 0 225 200])
     
#attack-class
(name *)	Attack
(type *)	attack ship
(* state is
 [0 0 90 100 200 751 #attack-class 500 2 250 [100 50 50 50] 0])

#near-target
(ship *)
(* initial state is
     [314 424 45 300 0 0 #attack-class 500 2 250 [100 50 50 50] 0 45 310])

#far-target
(ship *)
(* initial state is
     [424 314 225 500 0 0 #attack-class 500 2 250 [100 50 50 50] 0 225 410])

#distant-target
(ship *)
(* initial state is
     [154 984 135 600 0 0 #attack-class 500 2 250 [100 50 50 50] 0 135 525])

%% ----------------------------------------------------------------------

(reset $Ship)	($Ship initial state is $State)
		(now) ($Ship state is $State)

(set up $)	(exhaust) { *(ship $Ship) (reset $Ship) }

%% ----------------------------------------------------------------------

(test #turn-ship)
	(turn #test-ship to helm setting)
	(#test-ship heading 0)

(test #turn-ship-to-starboard)
	(set helm for #test-ship to 359)
	(#test-ship heading 315)
	(turn #test-ship to helm setting)
	(#test-ship heading 359)

(test #turn-ship-to-port)
	(set helm for #test-ship to 270)
	(turn #test-ship to helm setting)
	(#test-ship heading 270)

(test #turn-ship-about)
	(set helm for #test-ship to 135)
	(turn #test-ship to helm setting)
	(#test-ship heading 0)
	(turn #test-ship to helm setting)
	(#test-ship heading 45)
	(turn #test-ship to helm setting)
	(#test-ship heading 90)
	(turn #test-ship to helm setting)
	(#test-ship heading 135)
	(turn #test-ship to helm setting)
	(#test-ship heading 135)

(test #turn-ship-to-starboard-too-hard)
	(set helm for #test-ship to 45)
	(turn #test-ship to helm setting)
	(#test-ship heading 0)

(test #turn-ship-to-port-too-hard)
	(set helm for #test-ship to 225)
	(turn #test-ship to helm setting)
	(#test-ship heading 270)

(test #accelerate)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 7)

(test #accelerate-too-fast)
	(set throttle for #test-ship to gradient 9)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 7)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 9)

(test #accelerate-way-too-fast)
	(set throttle for #test-ship to gradient 10)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 7)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 9)

(test #decelerate)
	(set throttle for #test-ship to speed 0)
	(accelerate #test-ship to throttle setting)
	(#test-ship warp gradient 0)

(test #should-move-400)
	(#test-ship should move 400)

(test #should-move-141)
	(set destination for #test-ship to 3 4 4 5)
	(#test-ship should move 141)

(test #energy-for-warp-4)
	(#test-ship energy needed for distance 400 into 1)

(test #energy-for-warp-8)
	(#test-ship energy needed for distance 800 into $E)
	$E
	(assert $E = 6)

(test #can-move-16000)
	(decrease energy for #test-ship by 900)
	(#test-ship can move 16000 with remaining energy)

(test #can-move-1000)
	(decrease energy for #test-ship by 930)
	(#test-ship can move $Distance with remaining energy)
	$Distance
	(assert $Distance = 1000)

(test #move-toward-dest)
	(move #test-ship toward destination)
	(#test-ship coordinates into 3 4 2 3 6 6)
	(#test-ship energy 931)



