%% dgdebug -q arc-tests.dg arc.dg sectored-grid.dg unit.dg stdlib.dg

(list of tests [
	#firing-arc-closest-target
	#firing-arc-near-target
	#firing-arc-far-target
	#firing-arc-distant-target
	#shield-direction-closest-target
	#shield-direction-near-target
	#shield-direction-far-target
	#shield-direction-distant-target
	#due-north
	#due-northeast
	#due-east
	#due-southeast
	#due-south
	#due-southwest
	#due-west
	#due-northwest
	])

%% ----------------------------------------------------------------------

#test-ship
(grid object *)
(* state is [344 454 315])

(initial state [344 454 315])

(clean up $)   (initial state $State)
			   (now) (* state is $State)

#closest-target
(grid object *)
(* state is [354 444 0])

#near-target
(grid object *)
(* state is [314 424 0])

#far-target
(grid object *)
(* state is [424 314 0])

#distant-target
(grid object *)
(* state is [154 984 0])

#non-grid-object
(* state is [374 474 0])

#sun
(grid object *)
(* state is [577 577 0])

#planet
(grid object *)
(* state is [575 575 0])

#other-planet
(grid object *)
(* state is [573 573 0])

%% ----------------------------------------------------------------------

(test #firing-arc-closest-target)
      (firing arc from #test-ship to #closest-target is 2)

(test #firing-arc-near-target)
      (firing arc from #test-ship to #near-target is 1)

(test #firing-arc-far-target)
      (firing arc from #test-ship to #far-target is 2)

(test #firing-arc-distant-target)
      (firing arc from #test-ship to #distant-target is 6)

(test #shield-direction-closest-target)
      (shield direction for #closest-target against #test-ship is #east)

(test #shield-direction-near-target)
      (shield direction for #near-target against #test-ship is #north)

(test #shield-direction-far-target)
      (shield direction for #far-target against #test-ship is #east)

(test #shield-direction-distant-target)
      (shield direction for #distant-target against #test-ship is #west)

(move target to $DX $DY $X $Y)
      (drag #closest-target to 3 4 5 5)
      (turn #test-ship to face #closest-target)
      (drag #closest-target to $DX $DY $X $Y)

(test #due-north)
      (move target to 3 4 5 5)
      (firing arc from #test-ship to #closest-target is 1)
      (shield direction for #closest-target against #test-ship is #north)

(test #due-northeast)
      (move target to 3 4 6 5)
      (firing arc from #test-ship to #closest-target is 1)
      (shield direction for #closest-target against #test-ship is #north)

(test #due-east)
      (move target to 3 4 6 6)
      (firing arc from #test-ship to #closest-target is 2)
      (shield direction for #closest-target against #test-ship is #east)

(test #due-southeast)
      (move target to 3 4 6 7)
      (firing arc from #test-ship to #closest-target is 3)
      (shield direction for #closest-target against #test-ship is #east)

(test #due-south)
      (move target to 3 4 5 7)
      (firing arc from #test-ship to #closest-target is 5)
      (shield direction for #closest-target against #test-ship is #south)

(test #due-southwest)
      (move target to 3 4 4 7)
      (firing arc from #test-ship to #closest-target is 6)
      (shield direction for #closest-target against #test-ship is #west)

(test #due-west)
      (move target to 3 4 4 6)
      (firing arc from #test-ship to #closest-target is 7)
      (shield direction for #closest-target against #test-ship is #west)

(test #due-northwest)
      (move target to 3 4 4 5)
      (firing arc from #test-ship to #closest-target is 8)
      (shield direction for #closest-target against #test-ship is #north)
